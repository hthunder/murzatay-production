(()=>{"use strict";function t(){const t=document.querySelector(".instagram-widget__hidden-photos"),e=document.querySelector(".instagram-widget__hide-btn");t.classList.toggle("instagram-widget__hidden-photos_shown"),e.remove()}const e=(t,e)=>{let n=t,o=e;n||(n=document.querySelector(".comments__symbol-counter")),o||(o=document.querySelector(".sc-textarea__textarea")),n&&o&&(n.innerHTML=`${o.value.length}/500`,o.addEventListener("input",(t=>{const e=t.currentTarget;n.innerHTML=`${e.value.length}/500`})))},n=t=>{const{_id:e,user:{username:n,avatar:o="/img/icons/user-profile.svg"},text:a,date:s,isEditable:c,isDeletable:i}=t,r=document.createElement("article");return r.classList.add("comments__instance"),r.dataset.id=e,r.innerHTML=`\n        <img class="comments__instance-ava" src="${o}" alt="Аватарка">\n        <div class="comments__instance-content">\n            <p class="comments__instance-author">${n}</p>\n            <p class="comments__instance-text">${a}</p>\n            <time class="comments__instance-date" datetime="${new Date(s).toISOString()}">\n            ${new Date(s).toLocaleString("en-GB")}\n            </time>\n            ${((t,e)=>t&&e?'<form class="comments__form">\n            <button class="button comments__delete-button" type="button">Удалить</button>\n            <button class="button comments__edit-button" type="button">Редактировать</button> \n        </form>':t?'<form class="comments__form">\n            <button class="button comments__edit-button" type="button">Редактировать</button> \n        </form>':e?'<form class="comments__form">\n            <button class="button comments__delete-button" type="button">Удалить</button>\n        </form>':"")(c,i)}\n        </div>\n    `,r},o=async t=>{200===(await fetch(`/api/comments/${t.dataset.id}`,{method:"DELETE"})).status&&t.parentNode.removeChild(t)},a=(t,n,o)=>{const a=((t,e)=>{const n=document.createElement("form");return n.dataset.id=e,n.classList.add("comments__temp-form"),n.innerHTML=`<article class="textarea textarea_medium sc-textarea comments__sc-textarea">\n        <p class="sc-textarea__counter comments__symbol-counter">0/500</p>\n        <textarea class="sc-textarea__textarea" maxlength="500">${t}</textarea>\n        </article>\n        <button class="comments__save-button button" type="button">Сохранить</button>\n        <button class="comments__cancel-button button" type="button">Отменить</button>`,n})(t,n.dataset.id),s=a.querySelector(".sc-textarea__textarea"),c=a.querySelector(".comments__symbol-counter"),i=a.querySelector(".comments__cancel-button"),r=a.querySelector(".comments__save-button");n.appendChild(a),r.onclick=()=>{(async(t,e,n,o)=>{await(async(t,e,n)=>{const o=t,a=await fetch(`/api/comments/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(200===a.status){const t=await a.json();o.textContent=t.text}})(t.querySelector(".comments__instance-text"),o.value,n.dataset.id),t.classList.toggle("comments__instance-content_hidden"),e.classList.toggle("comments__temp-form_hidden")})(o,a,n,s)},i.onclick=()=>{var t;t=a,o.classList.toggle("comments__instance-content_hidden"),t.classList.toggle("comments__temp-form_hidden")},e(c,s)},s=t=>{const e=t.querySelector(".comments__instance-text").textContent,n=t.querySelector(".comments__instance-content"),o=document.querySelector(`.comments__temp-form[data-id='${t.dataset.id}']`);n.classList.toggle("comments__instance-content_hidden"),o?(o.classList.toggle("comments__temp-form_hidden"),o.querySelector(".sc-textarea__textarea").value=e,o.querySelector(".comments__symbol-counter").innerHTML=`${e.length}/500`):a(e,t,n)},c=(t,e,n)=>{e&&n&&(n.onchange=()=>((t,e,{files:n})=>{n[0].size>1024*t?(alert(`Размер файла превышает допустимые ${t>=1024?t/1024:t} ${t>=1024?"мб":"кб"}`),e.disabled=!0):e.disabled=!1})(t,e,n))},i=async(t,e,n,o)=>{const{userId:a}=t.dataset,s="PATCH"===e?await fetch(`/api/users/${a}`,{method:e,mode:"same-origin",body:new FormData(n)}):await fetch(`api/users/${a}`),i=(t=>{const{username:e="",city:n="",about:o="",avatar:a="/img/icons/user-profile.svg"}=t,s=document.createElement("section");return s.classList.add("my-page__about"),s.innerHTML=`\n        <img class="my-page__about-avatar" src="${a}" alt="Ваше фото">\n        <div class="my-page__about-info">\n            <button class="my-page__about-edit-button button button_light" type="button">Редактировать</button>\n            <div class="my-page__about-fields">\n                <p class="my-page__about-field my-page__about-username">Ник: ${e}</p>\n                <p class="my-page__about-field my-page__about-city">Город: ${n}</p>\n                <p class="my-page__about-field my-page__about-me">Расскажите о себе или о своих питомцах:</p>\n                <p class="my-page__about-field">${o}</p>\n            </div>\n            <form class="my-page__about-edit-form my-page__about-edit-form_hidden">\n                <label class="my-page__avatar-label button button_light">\n                    Загрузить аватар\n                    <input class="my-page__avatar-input" type="file" name="avatar" accept=".jpg, .jpeg, .png">   \n                </label>\n                <label class="my-page__about-form-label">\n                    Ник:\n                    <input class="my-page__about-form-input" name="username" type="text" value="${e}">\n                </label>\n                <label class="my-page__about-form-label">\n                    Город:\n                    <input name="city" type="text" value="${n}" class="my-page__about-form-input">\n                </label>\n                <label class="my-page__about-form-label">\n                        Расскажите о себе или своих питомцах:\n                    <textarea maxlength="250" name="about" placeholder="Расскажите о себе или своих питомцах"\n                        class="my-page__about-form-textarea textarea">${o}</textarea>\n                </label>\n                <button class="my-page__about-form-submit button button_light" type="button">Готово</button>\n            </form>\n        </div>\n    `,s})(await s.json());"PATCH"===e?t.replaceChild(i,o):t.appendChild(i);const m=document.querySelector(".my-page__about-form-submit"),l=document.querySelector(".my-page__avatar-input");c(200,m,l),r(m,t,i)},r=(t,e,n)=>{const o=n.querySelector(".my-page__about-edit-button"),a=n.querySelector(".my-page__about-edit-form"),s=n.querySelector(".my-page__about-fields");o&&(o.onclick=()=>{a.classList.toggle("my-page__about-edit-form_hidden"),s.classList.toggle("my-page__about-fields_hidden")}),t&&(t.onclick=()=>{i(e,"PATCH",a,n)})},m=t=>t.map((t=>`<a class="instagram-widget__photo-link" href=${t.permalink}>\n                <img class="instagram-widget__photo-img" src="${t.path.split("public")[1]}" />\n            </a>`)).join("\n"),l=t=>{const e=decodeURIComponent(document.cookie).split("; ").find((e=>e.startsWith(`${t}=`)));return e?e.split("=")[1]:""},u=t=>{document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC;`},d=(t,e)=>{const n=document.querySelector(`.nav__button_${t}`);if(n){const o=document.createElement("p"),a=document.querySelector(`.pop-up__${t} .pop-up__submit`),{parentElement:s}=a;o.classList.add("pop-up__errors"),s.insertBefore(o,a),o.innerText=e,u("murzatay-error"),u(`call-${t}`),setTimeout((()=>{s.removeChild(o)}),1e4),n.click()}},_=(t,e=500)=>"none"===window.getComputedStyle(t).display?((t,e)=>{t.style.removeProperty("display");let{display:n}=window.getComputedStyle(t);"none"===n&&(n="block"),t.style.display=n;const o=t.offsetHeight;t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.style.overflow="hidden",t.style.boxSizing="border-box",t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=`${e}ms`,t.style.height=`${o}px`,t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout((()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)})(t,e):((t,e)=>{t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=`${e}ms`,t.style.boxSizing="border-box",t.style.height=`${t.offsetHeight}px`,t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.style.overflow="hidden",window.setTimeout((()=>{t.style.display="none",t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)})(t,e);function p(t){t.style.opacity=1,function e(){t.style.opacity-=.1,t.style.opacity<=0?(t.style.display="none",t.style.opacity=null):requestAnimationFrame(e)}()}function y(t,e){t.style.opacity=0,t.style.display=e||"block",function e(){let n=parseFloat(t.style.opacity);n+=.1,n>1||(t.style.opacity=n,requestAnimationFrame(e))}()}const g=(t,e)=>{t&&(t.onclick=()=>{e.forEach((t=>{t()}))})};(()=>{const t=document.querySelector(".nav__button_login"),e=document.querySelector(".pop-up__login"),n=document.querySelector(".pop-up__login .pop-up__cancel-btn"),o=document.querySelector(".nav__button_signup"),a=document.querySelector(".pop-up__signup"),s=document.querySelector(".pop-up__signup .pop-up__cancel-btn"),c=document.querySelector(".pop-up__overlay");g(t,[()=>_(e),()=>y(c)]),g(n,[()=>_(e),()=>p(c)]),g(c,[()=>p(e),()=>p(c),()=>p(a)]),g(o,[()=>_(a),()=>y(c)]),g(s,[()=>_(a),()=>p(c)])})();const b=document.getElementById("image"),h=document.querySelector(".edit__submit");c(200,h,b);const f=document.querySelector(".articles__delete-button"),v=document.querySelector(".articles__delete-form");var w,S;S=()=>{v.submit()},(w=f)&&(w.onclick=()=>{window.confirm("Вы уверены, что хотите удалить эту статью?")&&S()});const q=document.querySelector(".nav__burger"),x=document.querySelector(".nav__list");q.onclick=()=>{x.classList.toggle("nav__list_opened")};const $=document.querySelector(".nav__search"),L=document.querySelector(".nav__search-form");$.onclick=()=>{L.classList.toggle("nav__search-form_opened")};const k=document.querySelector(".header__rubrics-btn"),T=document.querySelector(".rubrics");var C;k.onclick=()=>{T.classList.toggle("rubrics_opened")},(()=>{const t=document.querySelector(".topic__add-favourite");t&&(t.onclick=async function(){const{articleId:e}=t.dataset,{userId:n}=t.dataset;try{const o=await fetch(`/api/users/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({favourites:`${e}`})}),a=await o.json();(a.favourites&&!t.classList.contains("topic__add-favourite_active")||!a.favourites&&t.classList.contains("topic__add-favourite_active"))&&t.classList.toggle("topic__add-favourite_active")}catch(t){console.log(t)}})})(),function(){const t=localStorage.getItem("cookieDate"),e=document.getElementById("cookie_notification"),n=e.querySelector(".cookie__button");(!t||+t+31536e6<Date.now())&&e.classList.add("show"),n.addEventListener("click",(()=>{localStorage.setItem("cookieDate",Date.now()),e.classList.remove("show")}))}(),C=window.location.pathname,(async()=>{switch(C){case(C.match(/^\/articles\/\w+/)||{}).input:await(async()=>{await(async()=>{const t=document.querySelector(".topic__js-add-comment"),a=document.querySelector(".topic__js-comments"),c=a.dataset.id;if(t){const a=(()=>{const t=document.createElement("form");return t.classList.add("comments__add-form"),t.innerHTML='\n    <article class="textarea textarea_medium sc-textarea comments__sc-textarea">\n        <p class="sc-textarea__counter comments__symbol-counter">0/500</p>\n        <textarea class="sc-textarea__textarea" name="text" maxlength="500"></textarea>    \n    </article>\n    <button class="comments__add-button comments__send-button button" type="button"  data-id="">Отправить</button>\n    ',t})();t.appendChild(a);const i=a.querySelector(".comments__add-button"),r=a.querySelector(".sc-textarea__textarea");e(),i.onclick=()=>{(async(t,e)=>{const a=e,c={articleId:t,text:e.value},i=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(200===i.status){const t=await i.json();a.value="";const e=new Event("input");a.dispatchEvent(e);const c=n(t);document.querySelector(".comments__add-form").after(c);const r=c.querySelector(".comments__delete-button"),m=c.querySelector(".comments__edit-button");r.onclick=()=>{o(c)},m.onclick=()=>{s(c)}}})(c,r)}}const i=await fetch(`/api/articles/${c}/comments`);200===i.status&&(await i.json()).map((t=>n(t))).forEach((t=>{a.appendChild(t)}))})(),document.querySelectorAll(".comments__instance").forEach((t=>{const e=t.querySelector(".comments__delete-button"),n=t.querySelector(".comments__edit-button");e&&(e.onclick=()=>{o(t)}),n&&(n.onclick=()=>{s(t)})}))})();break;case(C.match(/^\/my-page$/)||{}).input:await(async()=>{const t=document.querySelector(".my-page__js-about");i(t)})();break;case(C.match(/^\/auth\/password-reset/)||{}).input:(()=>{const t=document.querySelector(".forgot-pass__form");var e;e=()=>{return e=t.querySelector("input[name='pass1']"),n=t.querySelector("input[name='pass2']"),!(!e||!n)&&e.value===n.value;var e,n},t.onsubmit=t=>(t.preventDefault(),e()?t.currentTarget.submit():window.createNotification({closeOnClick:!0,displayCloseButton:!0,positionClass:"nfc-top-right",showDuration:"5000",theme:"error"})({message:"Пароли не совпадают"}))})()}})(),(async()=>{const t=document.querySelector(".sidebar__js-last-comments");if(t)try{const e=await fetch("/api/comments?limit=2"),n=await e.json(),o=document.createElement("h3");o.classList.add("sidebar__title"),o.innerText="Комментарии",t.appendChild(o),n.map((e=>t.appendChild((({text:t,user:{username:e,avatar:n="/img/icons/user-profile.svg"}})=>{const o=document.createElement("figure");return o.classList.add("sidebar__comments-item"),o.innerHTML=`\n    <img class="sidebar__comments-img" src="${n}" width="38" height="38" alt="Аватарка" >\n    <figcaption>\n        <p class="sidebar__comments-text">${t}</p>\n        <p class="sidebar__comments-author">${e}</p>\n    </figcaption>\n    `,o})(e))))}catch(e){t.remove()}})(),(async()=>{const t=document.querySelector(".sidebar__js-instagram-widget");if(t)try{const e=await fetch("/api/widget-urls");return((t,{imgList:e})=>{t.innerHTML=`\n    <a class="instagram-widget__profile-link" href="https://www.instagram.com">\n        <img class="instagram-widget__profile-icon" width="50" height="50" src="/img/icons/instagram.svg" />\n        murzatay_dakian\n    </a>\n    <div class="instagram-widget__photos">\n        ${m(e.slice(0,15))}\n        <div class="instagram-widget__hidden-photos">\n            ${m(e.slice(15,18))}\n        </div>\n    </div>\n    <button class="instagram-widget__hide-btn">\n        Показать больше фото...\n    </button>\n    <a class="instagram-widget__subscribe-btn" href="https://www.instagram.com">\n        <img class="instagram-widget__subscribe-img" width="15" height="15" src="/img/icons/instagram-without-outline.svg" />\n        Открыть Instagram и подписаться\n    </a>\n    `})(t,await e.json()),"success"}catch(e){t.remove()}})().then((()=>{document.querySelector(".instagram-widget__hide-btn").onclick=t})),(async()=>{const t=l("murzatay-error"),e=l("murzatay-message"),n=l("call-login"),o=l("call-signup");t&&(n?d("login",t):o?d("signup",t):(u("murzatay-error"),window.createNotification({closeOnClick:!0,displayCloseButton:!0,positionClass:"nfc-top-right",showDuration:"5000",theme:"error"})({message:t}))),e&&(u("murzatay-message"),window.createNotification({closeOnClick:!0,displayCloseButton:!0,positionClass:"nfc-top-right",showDuration:"5000",theme:"success"})({message:e}))})()})();